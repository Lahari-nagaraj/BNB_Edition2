<%- include('partials/header') %>

<div class="hero">
  <h2>🏛️ Public Budget Transparency Portal</h2>
  <p>Explore approved public budgets with complete transparency</p>

  <!-- Filter Form -->
  <form method="get" class="filter-form">
    <input type="text" name="q" placeholder="🔍 Search..." value="<%= searchQuery %>">

    <select name="state">
      <option value="">📍 All States</option>
      <% states.forEach(state => { %>
        <option value="<%= state %>" <%= userState===state ? 'selected':'' %>><%= state %></option>
      <% }) %>
    </select>

    <select name="city">
      <option value="">🏙️ All Cities</option>
      <% cities.forEach(city => { %>
        <option value="<%= city %>" <%= userCity===city ? 'selected':'' %>><%= city %></option>
      <% }) %>
    </select>

    <select name="department">
      <option value="">🏢 All Departments</option>
      <% departments.forEach(dept => { %>
        <option value="<%= dept %>" <%= department===dept ? 'selected':'' %>><%= dept %></option>
      <% }) %>
    </select>

    <select name="status">
      <option value="">📊 All Status</option>
      <% statuses.forEach(stat => { %>
        <option value="<%= stat %>" <%= status===stat ? 'selected':'' %>><%= stat %></option>
      <% }) %>
    </select>

    <button type="submit">🔍 Search</button>
  </form>
</div>

<!-- Budget Cards -->
<div class="cards">
  <% budgets.forEach(budget=>{ %>
  <div class="card budget-card">
    <div class="card-header">
      <h3><%= budget.name %></h3>
      <span class="status-badge status-<%= budget.status %>"><%= budget.status %></span>
    </div>

    <% if (budget.aiSummary) { %>
      <div class="ai-summary-preview">
        <div class="ai-icon">🤖</div>
        <p class="ai-text"><%= budget.aiSummary.substring(0,100) %>...</p>
      </div>
    <% } %>

    <div class="budget-info">
      <p><strong>🏢 Department:</strong> <%= budget.department %></p>
      <p><strong>📍 State:</strong> <%= budget.state %></p>
      <p><strong>💰 Total:</strong> ₹<%= budget.totalBudget.toLocaleString() %></p>
      <p><strong>📅 Year:</strong> <%= budget.fiscalYear %></p>
    </div>

    <div class="progress-section">
      <div class="progress-bar">
        <div class="progress-fill" style="width:<%= (budget.spent/budget.totalBudget*100) %>%"></div>
      </div>
      <p class="spending-info">
        <span class="spent">Spent: ₹<%= budget.spent.toLocaleString() %></span>
        <span class="remaining">Remaining: ₹<%= budget.remaining.toLocaleString() %></span>
      </p>
    </div>

    <div class="card-actions">
      <a href="/budget/<%= budget._id %>"><button>📋 View</button></a>
      <a href="/budget/<%= budget._id %>/enhanced"><button class="btn-ai">🤖 AI Enhanced</button></a>
      <button class="btn-verify" onclick="showBudgetVerification('<%= budget._id %>')">🔍 Verify</button>
    </div>
  </div>
  <% }) %>
</div>

<!-- Include AI Assistant -->
<%- include('ai') %>

<%- include('partials/footer') %>
